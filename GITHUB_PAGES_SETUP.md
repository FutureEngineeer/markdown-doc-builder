# Настройка GitHub Pages

## Быстрый старт

### 1. Включите GitHub Pages в настройках репозитория

1. Перейдите в **Settings** → **Pages**
2. В разделе **Source** выберите **GitHub Actions**
3. Сохраните изменения

### 2. Обновите baseUrl в config.yaml

```yaml
site:
  baseUrl: "https://ваш-username.github.io/название-репозитория"
```

Замените:
- `ваш-username` на ваш GitHub username
- `название-репозитория` на название вашего репозитория

### 3. Запустите деплой

Деплой запустится автоматически при пуше в ветку `main` или `master`.

Или запустите вручную:
1. Перейдите в **Actions**
2. Выберите workflow **Deploy to GitHub Pages**
3. Нажмите **Run workflow**

## Доступные Workflows

### 1. Deploy to GitHub Pages (pages.yml)
**Основной workflow для деплоя**

- ✅ Запускается при пуше в `main`/`master`
- ✅ Можно запустить вручную
- ✅ Кеширует репозитории и оптимизированные ресурсы
- ✅ Оптимизирует только новые изображения

**Когда использовать:** Для обычного деплоя после изменений

### 2. Build and Deploy (Advanced) (build-and-deploy.yml)
**Продвинутый workflow с дополнительными опциями**

- ✅ Запускается по расписанию (каждые 12 часов)
- ✅ Можно запустить вручную с опцией полной пересборки
- ✅ Проверяет изменения в подключенных репозиториях
- ✅ Умное кеширование

**Когда использовать:** 
- Для автоматического обновления документации из внешних репозиториев
- Когда нужна полная пересборка (force rebuild)

## Оптимизация

### Умная оптимизация изображений

Система автоматически оптимизирует только новые или измененные изображения:

```bash
# Локальная оптимизация
npm run optimize:images:smart

# Анализ изображений
npm run optimize:images
```

### Кеширование

Кешируются:
- ✅ Скачанные репозитории (`.temp/repos`)
- ✅ Метаданные репозиториев (`.temp/repos-cache.json`)
- ✅ Оптимизированные изображения (`dist/assets`)
- ✅ Хеши оптимизированных файлов (`.temp/image-optimization-cache.json`)

### Очистка кеша

```bash
# Очистить весь кеш
npm run cache:clear

# Информация о кеше
npm run cache:info
```

## Проверка работоспособности

### 1. Проверьте статус деплоя

1. Перейдите в **Actions**
2. Найдите последний запуск workflow
3. Убедитесь что все шаги выполнены успешно (зеленые галочки)

### 2. Проверьте сайт

Откройте `https://ваш-username.github.io/название-репозитория`

### 3. Локальная проверка

```bash
# Сборка
npm run build:all

# Проверка индекса
npm run index:check

# Тест поиска
npm run search:test
```

## Устранение проблем

### Деплой не запускается

1. Проверьте что GitHub Pages включен в настройках
2. Убедитесь что выбран источник **GitHub Actions**
3. Проверьте что workflow файлы находятся в `.github/workflows/`

### Ошибка 404 после деплоя

1. Проверьте `baseUrl` в `config.yaml`
2. Убедитесь что путь соответствует вашему репозиторию
3. Подождите несколько минут - деплой может занять время

### Изображения не оптимизируются

Установите необходимые пакеты:

```bash
npm install --save-dev imagemin imagemin-mozjpeg imagemin-pngquant imagemin-gifsicle imagemin-svgo
```

### Репозитории не обновляются

1. Запустите **Build and Deploy (Advanced)** вручную
2. Выберите опцию **force_rebuild: true**
3. Или очистите кеш локально и сделайте коммит

## Производительность

### Время сборки

- **Первая сборка:** 2-5 минут (скачивание репозиториев)
- **Последующие сборки:** 30-60 секунд (с кешем)
- **Полная пересборка:** 2-5 минут

### Размер кеша

- Репозитории: ~10-50 MB
- Оптимизированные изображения: зависит от количества
- Метаданные: <1 MB

### Оптимизация изображений

- **GIF:** до 80% экономии
- **PNG:** до 30% экономии  
- **JPEG:** до 30% экономии
- **SVG:** до 20% экономии

## Дополнительные возможности

### Автоматическое обновление

Workflow **Build and Deploy (Advanced)** автоматически проверяет обновления в подключенных репозиториях каждые 12 часов.

Для изменения частоты отредактируйте `.github/workflows/build-and-deploy.yml`:

```yaml
schedule:
  - cron: '0 */6 * * *'  # Каждые 6 часов
```

### Ручной деплой с опциями

1. Перейдите в **Actions**
2. Выберите **Build and Deploy (Advanced)**
3. Нажмите **Run workflow**
4. Выберите опции:
   - `force_rebuild: true` - полная пересборка без кеша
   - `force_rebuild: false` - обычная сборка с кешем

## Мониторинг

### Логи сборки

Все логи доступны в разделе **Actions** → выберите запуск → просмотрите шаги

### Статистика

```bash
# Информация о кеше
npm run cache:info

# Анализ изображений
npm run optimize:images

# Проверка индекса
npm run index:check
```

## Полезные ссылки

- [GitHub Pages Documentation](https://docs.github.com/en/pages)
- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [Imagemin Documentation](https://github.com/imagemin/imagemin)

## Поддержка

Если возникли проблемы:

1. Проверьте логи в **Actions**
2. Убедитесь что все зависимости установлены
3. Попробуйте локальную сборку: `npm run build:all`
4. Очистите кеш: `npm run cache:clear`
