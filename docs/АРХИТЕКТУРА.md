# Архитектура генерации сайта

## Обзор

Система генерации работает в **4 фазы** (build-all-v2.js):

### 1️⃣ Phase 1: Индексация
Сканирует все файлы и строит полную структуру сайта

**Что происходит:**
- Индексирует локальные markdown файлы из `website/`
- Скачивает GitHub репозитории (с кешированием)
- Строит иерархию на основе `doc-config.yaml`
- Сохраняет в `.temp/hierarchy-info.json`

### 2️⃣ Phase 2: Построение структуры
Генерирует навигационные шаблоны и отображает дерево файлов

**Что происходит:**
- Строит полное дерево файлов из индекса
- Отображает цветную структуру в консоли
- Сохраняет метаданные для навигации

### 3️⃣ Phase 3: Генерация контента
Создаёт **ТОЛЬКО** контент `<main>` для каждой страницы

**Что происходит:**
- Парсит markdown → HTML (через converter.js)
- Обрабатывает карточки (features, specs, projects)
- Разрешает ссылки между файлами
- Сохраняет файлы БЕЗ HTML обёртки

### 4️⃣ Phase 4: Постпроцессинг
Оборачивает контент в полный HTML с навигацией

**Что происходит:**
- Добавляет `<header>` с breadcrumb
- Добавляет `<footer>` с социальными ссылками
- Генерирует `hamburger menu` (полная структура сайта)
- Генерирует `section map` (структура текущего раздела)
- Добавляет стили и скрипты
- **Хайлайт текущей страницы** в навигации

## Ключевые особенности

### ✅ Навигация В ТОЧНОСТИ соответствует индексу
- Hamburger menu и section map генерируются из `.temp/hierarchy-info.json`
- Структура полностью соответствует `doc-config.yaml`
- Хайлайт работает через точное сравнение путей

### ✅ Модульная архитектура
- Каждый этап независим
- Легко отлаживать
- Легко расширять

### ✅ Правильный хайлайт
- Только текущая страница получает класс `active`
- Используется точное сравнение путей
- Нет ложных срабатываний

## Запуск

```bash
npm run build
# или
node build-all-v2.js
```

## Компоненты системы

### Основные модули:
- **build-all-v2.js** - главный build скрипт (4 фазы)
- **converter.js** - конвертация markdown → HTML

### Компоненты (components/):
- **config.js** - глобальная конфигурация
- **header.js** - генерация header с breadcrumb
- **footer.js** - генерация footer с соцсетями
- **hamburgerMenu.js** - полное меню сайта
- **newSectionMap.js** - навигация по текущему разделу
- **overview.js** - парсинг overview секций
- **cardParser.js** - парсинг feature карточек
- **specParser.js** - парсинг спецификаций
- **projectParser.js** - обработка проектов
- **githubFetcher.js** - скачивание репозиториев
- **analytics.js** - интеграция Google Analytics
- **selectorParser.js** - интерактивные селекторы
- **scriptLoader.js** - модульная загрузка скриптов
- **utils.js** - утилиты

## Результат

```
dist/
├── index.html          # Полный HTML с навигацией
├── main.html           # Полный HTML с навигацией
├── CLN/
│   ├── index.html      # Полный HTML с навигацией (хайлайт на CLN/index.html)
│   └── ...
└── project-alpha/
    ├── main.html       # Полный HTML с навигацией (хайлайт на project-alpha/main.html)
    └── ...
```

Каждый файл содержит:
- ✅ Header с breadcrumb
- ✅ Footer с социальными ссылками
- ✅ Hamburger menu с хайлайтом текущей страницы
- ✅ Section map с хайлайтом текущей страницы
- ✅ Контент страницы
- ✅ Стили и скрипты
