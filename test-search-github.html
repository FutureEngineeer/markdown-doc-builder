<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Test - GitHub Pages</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>üîç Search Test - GitHub Pages</h1>
    
    <div class="test-section">
        <h2>Path Detection</h2>
        <div id="path-info"></div>
    </div>
    
    <div class="test-section">
        <h2>Search Index Loading</h2>
        <button onclick="testSearchIndex()">Test Load Index</button>
        <div id="index-result"></div>
    </div>
    
    <div class="test-section">
        <h2>URL Resolution</h2>
        <button onclick="testUrlResolution()">Test URLs</button>
        <div id="url-result"></div>
    </div>

    <script>
        // –ö–æ–ø–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ search.js –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function getSearchIndexPath() {
            const pathname = window.location.pathname;
            let basePath = pathname.substring(0, pathname.lastIndexOf('/') + 1);
            const pathParts = basePath.split('/').filter(p => p);
            
            if (pathParts.length > 0 && !pathParts[0].endsWith('.html')) {
                const depth = pathParts.length - 1;
                if (depth === 0) {
                    return 'search-index.json';
                } else {
                    return '../'.repeat(depth) + 'search-index.json';
                }
            }
            return 'search-index.json';
        }

        function getResultUrl(resultUrl) {
            let url = resultUrl.replace(/^\.\//, '');
            const pathname = window.location.pathname;
            const pathParts = pathname.split('/').filter(p => p && !p.endsWith('.html'));
            const depth = pathParts.length > 0 ? pathParts.length - 1 : 0;
            
            if (depth === 0) {
                return url;
            }
            return '../'.repeat(depth) + url;
        }

        function getCurrentPageUrl() {
            const pathname = window.location.pathname;
            const pathParts = pathname.split('/').filter(p => p);
            
            if (pathParts.length === 0) {
                return 'index.html';
            }
            
            const fileName = pathParts[pathParts.length - 1];
            if (!fileName.endsWith('.html')) {
                return 'index.html';
            }
            return fileName;
        }

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—É—Ç—è—Ö
        document.getElementById('path-info').innerHTML = `
            <div class="test-result">
                <strong>Current URL:</strong> ${window.location.href}<br>
                <strong>Pathname:</strong> ${window.location.pathname}<br>
                <strong>Search Index Path:</strong> ${getSearchIndexPath()}<br>
                <strong>Current Page URL:</strong> ${getCurrentPageUrl()}
            </div>
        `;

        async function testSearchIndex() {
            const resultDiv = document.getElementById('index-result');
            resultDiv.innerHTML = '<div class="test-result">Loading...</div>';
            
            try {
                const indexPath = getSearchIndexPath();
                console.log('Loading index from:', indexPath);
                
                const response = await fetch(indexPath);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <div class="test-result success">
                        ‚úÖ Index loaded successfully!<br>
                        <strong>Documents:</strong> ${data.documents.length}<br>
                        <strong>Index size:</strong> ${JSON.stringify(data.index).length} bytes
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        ‚ùå Failed to load index<br>
                        <strong>Error:</strong> ${error.message}<br>
                        <strong>Path:</strong> ${getSearchIndexPath()}
                    </div>
                `;
            }
        }

        function testUrlResolution() {
            const testUrls = [
                './index.html',
                './main.html',
                './CLN/readme.html',
                './project-alpha/main.html',
                'CLN/wiki/CLN17/readme.html'
            ];
            
            let html = '';
            testUrls.forEach(url => {
                const resolved = getResultUrl(url);
                html += `
                    <div class="test-result">
                        <strong>Original:</strong> ${url}<br>
                        <strong>Resolved:</strong> ${resolved}
                    </div>
                `;
            });
            
            document.getElementById('url-result').innerHTML = html;
        }
    </script>
</body>
</html>
