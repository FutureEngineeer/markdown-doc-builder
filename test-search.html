<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
        }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>üîç –¢–µ—Å—Ç –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –¥–≤–∏–∂–∫–∞</h1>
    
    <div class="test-section">
        <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ñ–∞–π–ª–æ–≤</h2>
        <button onclick="testIndexFile()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å search-index.json</button>
        <button onclick="testSearchScript()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å search.js</button>
        <div id="files-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Lunr.js</h2>
        <button onclick="testLunr()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Lunr.js</button>
        <div id="lunr-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–¥–µ–∫—Å–∞</h2>
        <button onclick="testLoadIndex()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω–¥–µ–∫—Å</button>
        <div id="index-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>4. –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫</h2>
        <input type="text" id="test-query" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å..." style="width: 300px; padding: 8px;">
        <button onclick="testSearch()">–ò—Å–∫–∞—Ç—å</button>
        <div id="search-result" class="result"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script>
    <script>
        let testIndex = null;
        let testDocuments = null;

        async function testIndexFile() {
            const result = document.getElementById('files-result');
            try {
                const response = await fetch('./dist/search-index.json');
                if (response.ok) {
                    const data = await response.json();
                    result.innerHTML = `<span class="success">‚úÖ –ò–Ω–¥–µ–∫—Å –Ω–∞–π–¥–µ–Ω! –î–æ–∫—É–º–µ–Ω—Ç–æ–≤: ${data.documents.length}</span>`;
                } else {
                    result.innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞: ${response.status} ${response.statusText}</span>`;
                }
            } catch (error) {
                result.innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</span>`;
            }
        }

        async function testSearchScript() {
            const result = document.getElementById('files-result');
            try {
                const response = await fetch('./dist/assets/scripts/search.js');
                if (response.ok) {
                    result.innerHTML += '<br><span class="success">‚úÖ search.js –Ω–∞–π–¥–µ–Ω!</span>';
                } else {
                    result.innerHTML += `<br><span class="error">‚ùå search.js –Ω–µ –Ω–∞–π–¥–µ–Ω: ${response.status}</span>`;
                }
            } catch (error) {
                result.innerHTML += `<br><span class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</span>`;
            }
        }

        function testLunr() {
            const result = document.getElementById('lunr-result');
            if (typeof lunr !== 'undefined') {
                result.innerHTML = `<span class="success">‚úÖ Lunr.js –∑–∞–≥—Ä—É–∂–µ–Ω! –í–µ—Ä—Å–∏—è: ${lunr.version || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞'}</span>`;
            } else {
                result.innerHTML = '<span class="error">‚ùå Lunr.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!</span>';
            }
        }

        async function testLoadIndex() {
            const result = document.getElementById('index-result');
            try {
                result.innerHTML = '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–¥–µ–∫—Å–∞...';
                
                const response = await fetch('./dist/search-index.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                testIndex = lunr.Index.load(data.index);
                testDocuments = data.documents;
                
                result.innerHTML = `<span class="success">‚úÖ –ò–Ω–¥–µ–∫—Å –∑–∞–≥—Ä—É–∂–µ–Ω!<br>
                    –î–æ–∫—É–º–µ–Ω—Ç–æ–≤: ${testDocuments.length}<br>
                    –ü–æ–ª–µ–π: ${data.index.fields ? data.index.fields.length : 'N/A'}<br>
                    –í–µ—Ä—Å–∏—è Lunr: ${data.index.version || 'N/A'}</span>`;
            } catch (error) {
                result.innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</span>`;
            }
        }

        function testSearch() {
            const result = document.getElementById('search-result');
            const query = document.getElementById('test-query').value;
            
            if (!testIndex) {
                result.innerHTML = '<span class="error">‚ùå –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–Ω–¥–µ–∫—Å!</span>';
                return;
            }
            
            if (!query || query.length < 2) {
                result.innerHTML = '<span class="error">‚ùå –í–≤–µ–¥–∏—Ç–µ –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞</span>';
                return;
            }
            
            try {
                const searchResults = testIndex.search(query + '*');
                
                if (searchResults.length === 0) {
                    result.innerHTML = '<span class="error">‚ùå –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</span>';
                    return;
                }
                
                let html = `<span class="success">‚úÖ –ù–∞–π–¥–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${searchResults.length}</span><br><br>`;
                
                searchResults.slice(0, 5).forEach((res, idx) => {
                    const doc = testDocuments[parseInt(res.ref)];
                    html += `<strong>${idx + 1}. ${doc.title}</strong><br>`;
                    html += `URL: ${doc.url}<br>`;
                    html += `Breadcrumb: ${doc.breadcrumb}<br>`;
                    html += `Score: ${res.score.toFixed(3)}<br><br>`;
                });
                
                result.innerHTML = html;
            } catch (error) {
                result.innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: ${error.message}</span>`;
            }
        }
    </script>
</body>
</html>
